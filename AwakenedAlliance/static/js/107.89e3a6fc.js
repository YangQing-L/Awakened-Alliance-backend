"use strict";(self["webpackChunkawakened_alliance"]=self["webpackChunkawakened_alliance"]||[]).push([[107],{3389:function(e,t,n){n.d(t,{S:function(){return a}});n(7658);var s=n(7387),r=n.n(s),o=n(1120),c=n(680);const a=e=>{window.refresh_id=-1;const t=()=>{if(!c.Z.get("refresh"))return o.Z.push("/login"),!1;s(),i()},n=()=>{if(!c.Z.get("refresh"))return o.Z.push("/login"),!1;s(),l()},s=()=>{a(),-1!=window.refresh_id&&(clearInterval(window.refresh_id),window.refresh_id=-1),window.refresh_id=setInterval(a,27e4)},a=()=>{r().ajax({url:"https://app4689.acapp.acwing.com.cn:4436/api/token/refresh/",type:"post",data:{refresh:c.Z.get("refresh")},success:e=>{console.log("access刷新成功:",e.access);let t=new Date(1*new Date+27e4);c.Z.set("access",e.access,{expires:t})},error:()=>{console.log("access刷新失败")}})},i=()=>{r().ajax({url:"https://app4689.acapp.acwing.com.cn:4436/settings/getinfo_jwt/",type:"get",data:{platform:e.state.platform},headers:{Authorization:"Bearer "+c.Z.get("access")},success:function(t){"success"===t.result?(e.commit("udpateUsername",t.username),e.commit("updatePhoto",t.photo)):console.log("jwt还未登录")},error:()=>{console.log("jwt登录报错"),o.Z.push("/login")}})},l=()=>{r().ajax({url:"https://app4689.acapp.acwing.com.cn:4436/apply_code/",type:"get",success:function(e){console.log("getinfo_acapp:",e),"success"===e.result&&u.api.oauth2.authorize(e.appid,e.redirect_uri,e.scope,e.state,(e=>{if("success"===e.result){let t=new Date(1*new Date+27e4);c.Z.set("access",e.access,{expires:t}),c.Z.set("refresh",e.refresh,{expires:14.5})}}))}})},u=e.state.AcWingOS;"AcWingOS"===u?t():n()}},6107:function(e,t,n){n.r(t),n.d(t,{default:function(){return j}});var s=n(3396);const r=e=>((0,s.dD)("data-v-b1c76a66"),e=e(),(0,s.Cn)(),e),o={class:"select_mode"},c=r((()=>(0,s._)("img",{src:"",alt:""},null,-1)));function a(e,t,n,r,a,i){const l=(0,s.up)("RankList");return(0,s.wg)(),(0,s.iD)("div",o,[c,(0,s._)("button",{onClick:t[0]||(t[0]=t=>e.start("single mode"))},"单人模式"),(0,s._)("button",{onClick:t[1]||(t[1]=t=>e.show_ranklist("single mode"))},"人机排行榜"),(0,s._)("button",{onClick:t[2]||(t[2]=t=>e.start("multi mode"))},"联机对战"),(0,s._)("button",{onClick:t[3]||(t[3]=t=>e.show_ranklist("multi mode"))},"联机排行榜"),(0,s._)("button",{onClick:t[4]||(t[4]=t=>e.logout_on_remote_jwt())},"登出"),e.$store.state.single_mode_list?((0,s.wg)(),(0,s.j4)(l,{key:0,select_type:"single mode score"})):(0,s.kq)("",!0),e.$store.state.ranklist?((0,s.wg)(),(0,s.j4)(l,{key:1,select_type:"rank score"})):(0,s.kq)("",!0)])}n(7658);var i=n(65),l=n(3389),u=n(1120),p=n(680),d=n(7139);const m={class:"ranklist"},f=["src"];function g(e,t,n,r,o,c){return(0,s.wg)(),(0,s.iD)("div",m,[(0,s._)("span",{class:"close-ranklist",onClick:t[0]||(t[0]=(...e)=>r.close_ranklist&&r.close_ranklist(...e))},"x"),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(r.players,(e=>((0,s.wg)(),(0,s.iD)("div",{class:"player",key:e.id},[(0,s._)("div",null,"#"+(0,d.zw)(e.rank),1),(0,s._)("div",null,[(0,s._)("img",{src:e.photo,alt:""},null,8,f)]),(0,s._)("div",null,(0,d.zw)(e.username),1),(0,s._)("div",null,(0,d.zw)(e.score),1)])))),128))])}var h=n(4870),_=n(7387),w=n.n(_),k={name:"RankList",props:{select_type:{type:String,required:!0}},setup(e){const t=(0,i.oR)();let n=(0,h.ref)([]);w().ajax({url:"https://app4689.acapp.acwing.com.cn:4436/get_ranklist/?select_type="+e.select_type,type:"get",headers:{Authorization:"Bearer "+p.Z.get("access")},success:e=>{const t=[];t.push(e.me,...e.all);let s=0;for(let n of t)n.id=s++;n.value=t}});const s=()=>{"single mode score"===e.select_type?t.commit("updateSingleModeList",!1):"rank score"===e.select_type&&t.commit("updateRanklist",!1)};return{players:n,close_ranklist:s}}},v=n(89);const y=(0,v.Z)(k,[["render",g],["__scopeId","data-v-4c967297"]]);var C=y,b={namespaced:!0,name:"SelectMode",components:{RankList:C},setup:()=>{const e=(0,i.oR)();(0,l.S)(e),(0,s.bv)((()=>{console.log("select mode Mounted")}));const t=t=>{e.commit("updateGameMode",t),u.Z.push("/select_hero")},n=t=>{"single mode"===t?e.commit("updateSingleModeList",!0):"multi mode"===t&&e.commit("updateRanklist",!0)},r=()=>{"ACAPP"===e.state.platform||(p.Z.remove("access"),p.Z.remove("refresh"),-1!=window.refresh_id&&clearInterval(window.refresh_id),u.Z.push("/login"))};return{start:t,show_ranklist:n,logout_on_remote_jwt:r}},methods:{}};const Z=(0,v.Z)(b,[["render",a],["__scopeId","data-v-b1c76a66"]]);var j=Z},680:function(e,t){
/*! js-cookie v3.0.1 | MIT */
function n(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)e[s]=n[s]}return e}var s={read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function r(e,t){function s(s,r,o){if("undefined"!==typeof document){o=n({},t,o),"number"===typeof o.expires&&(o.expires=new Date(Date.now()+864e5*o.expires)),o.expires&&(o.expires=o.expires.toUTCString()),s=encodeURIComponent(s).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var c="";for(var a in o)o[a]&&(c+="; "+a,!0!==o[a]&&(c+="="+o[a].split(";")[0]));return document.cookie=s+"="+e.write(r,s)+c}}function o(t){if("undefined"!==typeof document&&(!arguments.length||t)){for(var n=document.cookie?document.cookie.split("; "):[],s={},r=0;r<n.length;r++){var o=n[r].split("="),c=o.slice(1).join("=");try{var a=decodeURIComponent(o[0]);if(s[a]=e.read(c,a),t===a)break}catch(i){}}return t?s[t]:s}}return Object.create({set:s,get:o,remove:function(e,t){s(e,"",n({},t,{expires:-1}))},withAttributes:function(e){return r(this.converter,n({},this.attributes,e))},withConverter:function(e){return r(n({},this.converter,e),this.attributes)}},{attributes:{value:Object.freeze(t)},converter:{value:Object.freeze(e)}})}var o=r(s,{path:"/"});t["Z"]=o}}]);
//# sourceMappingURL=107.89e3a6fc.js.map